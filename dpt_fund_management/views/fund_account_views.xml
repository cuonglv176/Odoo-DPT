<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Tree View -->
        <record id="view_dpt_fund_account_tree" model="ir.ui.view">
            <field name="name">dpt.fund.account.tree</field>
            <field name="model">dpt.fund.account</field>
            <field name="arch" type="xml">
                <tree decoration-muted="not is_active">
                    <field name="code"/>
                    <field name="name"/>
                    <field name="fund_type"/>
                    <field name="currency_id"/>
                    <field name="balance" sum="Total Balance"/>
                    <field name="is_active"/>
                </tree>
            </field>
        </record>

        <!-- Form View -->
        <record id="view_dpt_fund_account_form" model="ir.ui.view">
    <field name="name">dpt.fund.account.form</field>
    <field name="model">dpt.fund.account</field>
    <field name="arch" type="xml">
        <form string="T√†i kho·∫£n Qu·ªπ">
            <header>
                <!-- Button quy ƒë·ªïi VND -->
                <button name="get_balance_in_currency"
                        string="üí± Quy ƒë·ªïi VND"
                        type="object"
                        class="btn-secondary"
                        invisible="currency_id == %(base.VND)d"/>

                <!-- Button Import - S·ª≠ d·ª•ng Python Action -->
                <button name="action_import_transactions"
                        string="üì• Import Giao D·ªãch"
                        type="object"
                        class="btn-primary"
                        invisible="account_type != 'bank'"
                        help="Import giao d·ªãch t·ª´ file Excel"/>

                <!-- Button Export -->
                <button name="action_export_transactions"
                        string="üì§ Export Excel"
                        type="object"
                        class="btn-secondary"
                        help="Xu·∫•t giao d·ªãch ra file Excel"/>

                <!-- Button ƒê·ªëi so√°t -->
                <button name="action_reconcile_account"
                        string="üîÑ ƒê·ªëi So√°t"
                        type="object"
                        class="btn-info"
                        invisible="account_type != 'bank'"
                        help="ƒê·ªëi so√°t s·ªë d∆∞ t√†i kho·∫£n"/>
            </header>

            <sheet>
                <div class="oe_button_box" name="button_box">
                    <!-- Smart Button - S·ªë l∆∞·ª£ng giao d·ªãch -->
                    <button class="oe_stat_button"
                            type="object"
                            name="action_view_transactions"
                            icon="fa-list-alt">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="transaction_count"/>
                            </span>
                            <span class="o_stat_text">Giao D·ªãch</span>
                        </div>
                    </button>

                    <!-- Smart Button - T·ªïng thu -->
                    <button class="oe_stat_button"
                            type="object"
                            name="action_view_income_transactions"
                            icon="fa-arrow-up"
                            style="color: green;">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="total_income" widget="monetary"/>
                            </span>
                            <span class="o_stat_text">T·ªïng Thu</span>
                        </div>
                    </button>

                    <!-- Smart Button - T·ªïng chi -->
                    <button class="oe_stat_button"
                            type="object"
                            name="action_view_expense_transactions"
                            icon="fa-arrow-down"
                            style="color: red;">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="total_expense" widget="monetary"/>
                            </span>
                            <span class="o_stat_text">T·ªïng Chi</span>
                        </div>
                    </button>
                </div>

                <!-- Ribbon tr·∫°ng th√°i -->
                <widget name="web_ribbon"
                        title="Kh√¥ng ho·∫°t ƒë·ªông"
                        bg_color="bg-danger"
                        invisible="is_active"/>

                <!-- Title -->
                <div class="oe_title">
                    <label for="name" class="oe_edit_only"/>
                    <h1>
                        <field name="name" placeholder="T√™n t√†i kho·∫£n qu·ªπ..."/>
                    </h1>
                    <div invisible="not account_number">
                        <h3 class="text-muted">
                            <i class="fa fa-credit-card"/>
                            <field name="account_number"/>
                            <span invisible="not bank_name"> - </span>
                            <field name="bank_name"/>
                        </h3>
                    </div>
                </div>

                <!-- Main Information -->
                <group>
                    <group string="Th√¥ng Tin C∆° B·∫£n">
                        <field name="code"/>
                        <field name="fund_type"/>
                        <field name="account_type"/>
                        <field name="currency_id" options="{'no_create': True}"/>
                        <field name="is_active"/>
                    </group>
                    <group string="S·ªë D∆∞ &amp; T√†i Kho·∫£n">
                        <field name="balance"
                               widget="monetary"
                               options="{'currency_field': 'currency_id'}"
                               style="font-size: 18px; font-weight: bold;"/>
                        <field name="available_balance"
                               widget="monetary"
                               options="{'currency_field': 'currency_id'}"/>
                        <field name="account_id"
                               options="{'no_create': True}"/>
                        <field name="account_number"
                               invisible="account_type != 'bank'"/>
                        <field name="bank_name"
                               invisible="account_type != 'bank'"/>
                    </group>
                </group>

                <!-- Notebook -->
                <notebook>
                    <page string="üìã Giao D·ªãch G·∫ßn ƒê√¢y" name="transactions">
                        <field name="transaction_ids"
                               readonly="1"
                               context="{'default_fund_account_id': active_id}">
                            <tree string="Giao D·ªãch"
                                  decoration-success="transaction_type == 'income'"
                                  decoration-danger="transaction_type == 'expense'"
                                  decoration-muted="state == 'cancelled'">
                                <field name="date"/>
                                <field name="name"/>
                                <field name="transaction_type"/>
                                <field name="amount"
                                       sum="T·ªïng C·ªông"
                                       widget="monetary"/>
                                <field name="reference"/>
                                <field name="state"/>
                            </tree>
                        </field>
                    </page>

                    <page string="üí∏ Chuy·ªÉn Ti·ªÅn" name="transfers">
                        <group>
                            <group string="üì§ Chuy·ªÉn ƒêi">
                                <field name="transfer_from_ids" nolabel="1">
                                    <tree decoration-info="state == 'pending'">
                                        <field name="date"/>
                                        <field name="name"/>
                                        <field name="to_fund_id"/>
                                        <field name="amount" widget="monetary"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </group>
                            <group string="üì• Chuy·ªÉn ƒê·∫øn">
                                <field name="transfer_to_ids" nolabel="1">
                                    <tree decoration-success="state == 'received'">
                                        <field name="date"/>
                                        <field name="name"/>
                                        <field name="from_fund_id"/>
                                        <field name="converted_amount" widget="monetary"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </group>
                        </group>
                    </page>

                    <page string="üìä Th·ªëng K√™" name="statistics">
                        <group>
                            <group string="üìà T·ªïng Quan T√†i Ch√≠nh">
                                <field name="total_income"
                                       widget="monetary"
                                       readonly="1"/>
                                <field name="total_expense"
                                       widget="monetary"
                                       readonly="1"/>
                                <field name="transaction_count" readonly="1"/>
                            </group>
                            <group string="üìÖ Th√¥ng Tin Th·ªùi Gian">
                                <field name="last_transaction_date" readonly="1"/>
                                <field name="create_date" readonly="1"/>
                                <field name="write_date" readonly="1"/>
                            </group>
                        </group>
                    </page>
                </notebook>
            </sheet>

            <!-- Chatter -->
            <div class="oe_chatter">
                <field name="message_follower_ids"/>
                <field name="message_ids"/>
            </div>
        </form>
    </field>
</record>


        <!-- Search View -->
        <record id="view_dpt_fund_account_search" model="ir.ui.view">
            <field name="name">dpt.fund.account.search</field>
            <field name="model">dpt.fund.account</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="code"/>
                    <field name="fund_type"/>
                    <field name="currency_id"/>
                    <separator/>
                    <filter string="Ho·∫°t ƒë·ªông" name="active" domain="[('is_active', '=', True)]"/>
                    <filter string="Kh√¥ng ho·∫°t ƒë·ªông" name="inactive" domain="[('is_active', '=', False)]"/>
                    <separator/>
                    <filter string="Qu·ªπ VN" name="vn_fund" domain="[('fund_type', '=', 'vn')]"/>
                    <filter string="Qu·ªπ TQ" name="china_fund" domain="[('fund_type', '=', 'china')]"/>
                    <filter string="T√†i kho·∫£n trung gian" name="intermediate"
                            domain="[('fund_type', '=', 'intermediate')]"/>
                    <group expand="0" string="Nh√≥m theo">
                        <filter string="Lo·∫°i qu·ªπ" name="group_fund_type" context="{'group_by': 'fund_type'}"/>
                        <filter string="Ti·ªÅn t·ªá" name="group_currency" context="{'group_by': 'currency_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Action -->
        <record id="action_dpt_fund_account" model="ir.actions.act_window">
            <field name="name">T√†i kho·∫£n Qu·ªπ</field>
            <field name="res_model">dpt.fund.account</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_active': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    T·∫°o t√†i kho·∫£n qu·ªπ ƒë·∫ßu ti√™n!
                </p>
                <p>
                    Qu·∫£n l√Ω c√°c t√†i kho·∫£n qu·ªπ VN, TQ v√† t√†i kho·∫£n trung gian.
                </p>
            </field>
        </record>

    </data>
</odoo>
